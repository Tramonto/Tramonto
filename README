# Tramonto: A molecular theory code for structured and uniform fluids
#                 Copyright (2006) Sandia Corporation
#
# Under terms of Contract DE-AC04-94AL85000, there is a non-exclusive
# license for use of this work by or on behalf of the U.S. Government.
#
# This library is free software; you can redistribute it and/or
# modify it under the terms of the GNU Lesser General Public License
# as published by the Free Software Foundation; either version 2.1
# of the License, or (at your option) any later version.
#
# This library is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU Lesser General Public License for more details.
#
# You should have received a copy of the GNU Lesser General Public
# License along with this library; if not, write to the Free Software
# Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA
# 02110-1301, USA.

                       How to Build Tramonto


Contents:
    Prerequisites
    Building Trilinos
    Building Tramonto
 

Prerequisites:

    Tramonto depends on a number of other software packages.  Below is a 
    list of the required packages and links from which you can download 
    any packages that are not available on your system.  There is a good
    chance that BLAS, LAPACK and an MPI implementation are already installed
    on your system.  It is especially important to have a BLAS library that
    is optimized for your machine.  

        Package                       Web Reference
        BLAS                       http://www.netlib.org
        LAPACK                     http://www.netlib.org
        MPI                        http://www-unix.mcs.anl.gov/mpi/mpich2
                                   http://www.open-mpi.org
        Trilinos (10.2.0 or later) http://trilinos.sandia.gov

    While BLAS, LAPACK and MPI could be available on your system, you will
    most likely have to build Trilinos yourself.  Trilinos contains several
    packages of which Tramonto requires amesos, aztecoo, triutils, ifpack,
    epetraext, epetra, loca, ml, nox, and teuchos.

    Trilinos has a webpage for new users available at
    http://trilinos.sandia.gov/getting_started.html.
    Below you will find a brief set of instructions that focus on building
    Trilinos for use with Tramonto.  If these instructions prove insufficient,
    please visit the website listed above.
    
Building Trilinos:

    As of April 2010, Tramonto requires Trilinos version 10.2.0 or later.

    Trilinos can be downloaded from the the Trilinos home page listed above.
    There are many options available in configuring Trilinos, some of the 
    most important one are:
    
    CMAKE_INSTALL_PREFIX:PATH=

        This option specifies where to install Trilinos.  For example,
        CMAKE_INSTALL_PREFIX:PATH=/path/TrilinosInstall will install Trilinos
        libraries in /path/TrilinosInstall/lib and Trilinos header files in
        /path/TrilinosInstall/include.

    TPL_ENABLE_MPI:BOOL=ON

        This option indicates that a parallel, rather than serial, 
        version of Trilinos should be built.

    DMPI_BASE_DIR:PATH=

        Use this option to specify the base installation directory for MPI.
        In many cases when using a standard setup, this is not necessary,
        but the option is useful when a machine contains multiple mpi
        installations, or mpi is installed in a non-standard location.  If
        /path is the base installation directory, /path/include contains mpi.h,
        /path/lib includes the mpi libraries, and /path/bin contains mpiexec
        (or equivalent mpi executable).
 
    TPL_BLAS_LIBRARIES:STRING=
    TPL_LAPACK_LIBRARIES:SRING=

        These options are used to specify the names or locations of the BLAS
        and LAPACK libraries.  If the options are not specified, Trilinos
        will attempt to find BLAS and LAPACK.  Again, it is best to 
        explicitly list the libraries you want to use if there are 
        multiple libraries available on your machine.  Example usage:
        TPL_BLAS_LIBRARIES:STRING="-lcblas;-lf77blas;-latlas;-lgfortran" or 
        TPL_BLAS_LIBRARIES:STRING=/usr/lib64/libblas.so and
        TPL_LAPACK_LIBRARIES:STRING=/usr/lib64/liblapack.so

    Trilinos_ENABLE_ALL_PACKAGES:BOOL=OFF 
    Trilinos_ENABLE_<package>:BOOL=ON

        The best way to build only the packages that Tramonto uses is to use 
        the Trilinos_ENABLE_ALL_PACKAGES:BOOL=OFF option in conjunction with
        a Trilinos_ENABLE_<package>:BOOL=ON option for each required
        Trilinos package.  For example Trilinos_ENABLE_AztecOO:BOOL=ON, etc.
        Note that it is not necessary to disable all of the packages that
        Tramonto does not use; this is especially useful when building Tramonto
        on a machine that has a pre-installed version of Trilinos.  It can be
        helpful to disable unneeded packages to make it easier and faster to
        build Trilinos.


    Below are examples of ways to properly configure Trilinos.  You can find
    more examples in the "sampleScripts" directory in the Trilinos
    distribution.  The configure command points up one directory because the
    preferred directory structure for building Trilinos has separate build and 
    source trees.  For example, for a build tree named "TramontoInstall",
    from the top-level Trilinos directory, type "mkdir TramontoInstall",
    then "cd TramontoInstall", and finally provide the proper configure
    arguments.  Some users prefer for the build tree to be a peer to the
    top-level Trilinos directory.  The source tree can be in any arbitrary
    location; the last argument in the configuration command simply has to
    point to the source tree with an absolute or relative path.  Often it is
    convenient to create a script (like those in the sampleScripts directory
    mentioned above) in the build directory and then simply source the script.
    If a separate build tree is not used, the configure process will terminate
    with an error.
		
    Linux 
     cmake \
     -DTPL_ENABLE_MPI:BOOL=ON \
     -DTrilinos_ENABLE_ALL_PACKAGES:BOOL=OFF \
     -DTrilinos_ENABLE_Amesos:BOOL=ON \
     -DTrilinos_ENABLE_AztecOO:BOOL=ON \
     -DTrilinos_ENABLE_Triutils:BOOL=ON \
     -DTrilinos_ENABLE_Ifpack:BOOL=ON \
     -DTrilinos_ENABLE_EpetraExt:BOOL=ON \
     -DTrilinos_ENABLE_Epetra:BOOL=ON \
     -DNOX_ENABLE_LOCA:BOOL=ON \
     -DTrilinos_ENABLE_ML:BOOL=ON \
     -DTrilinos_ENABLE_NOX:BOOL=ON \
     -DTrilinos_ENABLE_Teuchos:BOOL=ON \
     -DTrilinos_ENABLE_TESTS:BOOL=ON \
     -DCMAKE_CXX_FLAGS:STRING="-O3" \
     -DCMAKE_C_FLAGS:STRING="-O3" \
     -DCMAKE_Fortran_FLAGS:STRING="-O5" \
     -DTPL_BLAS_LIBRARIES:STRING="-lcblas;-lf77blas;-latlas;-lgfortran" \
     -DCMAKE_INSTALL_PREFIX:PATH=/home/jmwille/TramontoTestHarness/Tri10.2 \
     ..

    Mac OSX
     cmake \
     -DTrilinos_ENABLE_ALL_OPTIONAL_PACKAGES:BOOL=OFF \
     -DTPL_ENABLE_MPI:BOOL=ON \
     -DTrilinos_ENABLE_Amesos:BOOL=ON \
     -DTrilinos_ENABLE_AztecOO:BOOL=ON \
     -DTrilinos_ENABLE_Triutils:BOOL=ON \
     -DTrilinos_ENABLE_Ifpack:BOOL=ON \
     -DTrilinos_ENABLE_EpetraExt:BOOL=ON \
     -DTrilinos_ENABLE_Epetra:BOOL=ON \
     -DNOX_ENABLE_LOCA:BOOL=ON \
     -DTrilinos_ENABLE_ML:BOOL=ON \
     -DTrilinos_ENABLE_NOX:BOOL=ON \
     -DTrilinos_ENABLE_Teuchos:BOOL=ON \
     -DTrilinos_ENABLE_TESTS:BOOL=ON \
     -DCMAKE_CXX_FLAGS:STRING="-O3" \
     -DCMAKE_C_FLAGS:STRING="-O3" \
     -DCMAKE_Fortran_FLAGS:STRING="-O5" \
     -DMPI_BASE_DIR:PATH=/Users/jmwille/install \
     -DCMAKE_INSTALL_PREFIX:PATH=/Users/jmwille/TramontoTestHarness/Tri10.2 \
     ..

    Once you have configured Trilinos, build it by typing "make".  
    This will build the libraries, tests (if Trilinos_ENABLE_TESTS:BOOL=ON),
    and examples for the packages that were enabled at configure time.  If
    the tests were compiled, a test suite can be run by typing "ctest".
    Finally, install Trilinos using "make install".


Building Tramonto:

    Once Trilinos has been built, building Tramonto tends to be 
    straightforward because most of the options that were used to build
    Trilinos can be used automatically to build Tramonto.  As with Trilinos, 
    it is necessary to configure and then build Tramonto.  Since 
    Tramonto produces only a single executable, there is no need to 
    install it and at this time there is not a make target for testing.
    
    To configure Tramonto, it is necessary to indicate the location of the
    installed Trilinos libraries and header files using the TRILINOS_PATH
    option.  This option points to the base of the installed version of
    Trilinos.  For example, if Trilinos is configured with
    CMAKE_INSTALL_PREFIX:PATH=/Users/jmwille/TramontoTestHarness/Tri10.2, use

    TRILINOS_PATH:PATH=/Users/jmwille/TramontoTestHarness/Tri10.2

    Below are Tramonto configure invocations that correspond to the
    above Trilinos configure invocations.  These, as well as other,
    scripts can be found in the directory "sampleConfigs" in the Tramonto
    distribution.  Note that using a separate build tree is again
    required, as discussed in the Building Trilinos section.

    Linux
     cmake \
     -DCMAKE_CXX_FLAGS:STRING=-O3 \
     -DCMAKE_C_FLAGS:STRING=-O3 \
     -DTRILINOS_PATH=/home/jmwille/TramontoTestHarness/Tri10.2 \
     ..

    Mac OS X
     cmake \
     -DCMAKE_CXX_FLAGS:STRING=-O3 \
     -DCMAKE_C_FLAGS:STRING=-O3 \
     -DTRILINOS_PATH=/Users/jmwille/TramontoTestHarness/Tri10.2 \
     ..


    Once the configure script completes, you can type "make" to 
    build Tramonto. After make finishes, the Tramonto  binary, "dft_exec" 
    can optionally be copied to a more convenient location.  Note that
    although it is not necessary to specify the locations and names of
    the compilers because that information is taken from the Trilinos
    configuration process, it is currently necessary to specify
    compiler flags.

